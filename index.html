<!doctypehtml><html><head><meta charset=utf-8><title>Gravity Blur (WebAssembly)</title></head><body><div id=droparea align=center><button disabled id=load>Load</button><button disabled id=save>Save</button><br>options:<br><input id=cmdline value="-r 10 -s 50 -n 3"><br>filename:<br><input id=filename value="<empty>"><br><br><div id=status>You need to enable JavaScript to run this app.</div><div><progress hidden id=progress max=100 value=0></progress></div><textarea cols=80 id=output readonly rows=24 style=resize:none></textarea><div><script>var statusElement=document.getElementById("status"),progressElement=document.getElementById("progress"),outputElement=document.getElementById("output"),loadElement=document.getElementById("load"),saveElement=document.getElementById("save");outputElement.value="",loadElement.disabled=!0,saveElement.disabled=!0,Module={preRun:[],postRun:function(){initDrop(),loadElement.onclick=cbLoad,saveElement.onclick=cbSave,loadElement.disabled=!1},print:function(e){1<arguments.length&&(e=Array.prototype.slice.call(arguments).join(" ")),console.log(e),outputElement.value+=e+"\n",outputElement.scrollTop=outputElement.scrollHeight},printErr:function(e){1<arguments.length&&(e=Array.prototype.slice.call(arguments).join(" ")),console.log(e),outputElement.value+="!!! "+e+"\n",outputElement.scrollTop=outputElement.scrollHeight},setStatus:function(e){if(Module.setStatus.last||(Module.setStatus.last={time:Date.now(),text:""}),e!==Module.setStatus.last.text){var t=e.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/),n=Date.now();t&&n-Module.setStatus.last.time<30||(Module.setStatus.last.time=n,Module.setStatus.last.text=e,progressElement.hidden=!t||(e=t[1],progressElement.value=100*parseInt(t[2]),progressElement.max=100*parseInt(t[4]),!1),statusElement.innerHTML=e)}},totalDependencies:0,monitorRunDependencies:function(e){this.totalDependencies=Math.max(this.totalDependencies,e),Module.setStatus(e?"Preparing... ("+(this.totalDependencies-e)+"/"+this.totalDependencies+")":"All downloads complete.")}},Module.setStatus("Downloading..."),window.onerror=function(){Module.setStatus("Exception thrown, see JavaScript console"),Module.setStatus=function(e){e&&Module.printErr("[post-exception status] "+e)}};var out_canvas=null;function cbProcessImage(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");n.drawImage(e,0,0),v=n.getImageData(0,0,e.width,e.height).data;var a=document.getElementById("cmdline").value,o=a.length,l=v.length,u=Module._malloc(20+l+o+1);Module.HEAPU8.set(new Uint8Array(20),u);var d=u+20,s=u+20+l;Module.HEAPU8.set(v,d);for(var r=0;r<o;r++){var i=a.charCodeAt(r);127<i&&(i="?".charCodeAt(0)),Module.HEAPU8[s+r]=i}Module.HEAPU8[s+o]=0,Module.print("Processing...");var c=4*e.width;Module.HEAPU32[u/4]=e.width,Module.HEAPU32[u/4+1]=e.height,Module.HEAPU32[u/4+2]=4,Module.HEAPU32[u/4+3]=c,Module.HEAPU32[u/4+4]=d;var m=Module._web_process(u,s);if(Module._free(u),m){var p=Module.HEAPU32[m/4],g=Module.HEAPU32[m/4+1],E=(c=Module.HEAPU32[m/4+3],Module.HEAPU32[m/4+4]),v=Module.HEAPU8.slice(E,m+c*g);t.width=p,t.height=g;var h=n.getImageData(0,0,p,g);h.data.set(v,0),n.putImageData(h,0,0),Module._free(m)}else t=null;return t}function initDrop(){var t=document;["dragenter","dragover","dragleave","drop"].forEach(function(e){t.addEventListener(e,function(e){e.preventDefault(),e.stopPropagation()},!1)}),t.addEventListener("drop",function(e){var t=e.dataTransfer.files;1==t.length?readFile(t[0]):alert("Multiple file drop unsupported.")},!1)}function readFile(n){Module.print('Loading "'+n.name+'"'),document.getElementById("filename").value=n.name;var e=new FileReader;e.onload=function(e){saveElement.disabled=!0;var t=document.createElement("img");t.onload=function(){out_canvas=null,Module.print("Image: "+t.width+"x"+t.height+", "+n.type),out_canvas=cbProcessImage(t),saveElement.disabled=null===out_canvas},t.src=e.target.result},e.readAsDataURL(n)}function cbLoad(){var e=document.createElement("input");e.type="file",e.accept="image/unknown",e.onchange=function(e){readFile(e.target.files[0])},e.click()}function cbSave(){if(null!==out_canvas){var e=document.getElementById("filename").value,t=document.createElement("a"),n=e.lastIndexOf(".");n=n<1?"":e.substring(n).toLowerCase(),t.href=".jpg"===n||".jpeg"===n?out_canvas.toDataURL("image/jpeg",1):out_canvas.toDataURL("image/png"),t.download=e,t.click()}else alert("data undefined")}</script><script async src=gravityblur.js></script></div></div></body></html>